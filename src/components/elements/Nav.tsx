import React, { useEffect, useState } from 'react'
import { API_URI } from '../../App'
import { User } from '../models'

const Nav = (props: {
  HandleCreatePostModal:() => void,
  userInfos: User
}) => {
  const [isDropdownOpen, setIsDropdownOpen] = useState(false)

  const { userInfos, HandleCreatePostModal } = props

  const Logout = async () => {
    const userToken = localStorage.getItem('userToken')
    let fet = await fetch(`${API_URI}/user/logout`, {
      method: "DELETE",
      body: JSON.stringify({
        token: userToken
      }),
      headers: {
        'Content-Type': 'application/json'
      }
    })
    let repStatus = await fet.status
    if (repStatus == 204) {
      localStorage.removeItem('userToken')
      window.location.hash = 'signin'
    }
  }

  const HandleDropdown = () => {
    setIsDropdownOpen(!isDropdownOpen)
  }

  const Go_To_HomePage = () => {
    window.location.hash = ``
    setIsDropdownOpen(false)
  }

  const Go_To_Profile = () => {
    window.location.hash = `profile/${userInfos?._id}`
    setIsDropdownOpen(false)
  }
  
  return (
    <nav>
      <div className='nav_items'>
        {/* <img className='nav-logo' src={logo} /> */}
        <div className='nav-logo' style={{ top: 'auto', bottom: 3.5 }}>
          <span className='nav-logo-title' onClick={Go_To_HomePage}>Instaclone</span>
        </div>
        <div className='nav-actions'>
          <div className='nav-search'>
            <svg viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><path d="m468.336 454.484-127.895-127.894c59.331-66.677 57.052-169.224-6.857-233.132-32.108-32.109-74.8-49.793-120.208-49.793-45.409 0-88.1 17.684-120.208 49.792-66.283 66.284-66.283 174.135 0 240.418 32.109 32.108 74.8 49.792 120.208 49.792 42.058 0 81.779-15.181 112.925-42.933l127.893 127.893c1.953 1.952 4.512 2.929 7.071 2.929s5.118-.977 7.071-2.929c3.905-3.905 3.905-10.237 0-14.143zm-361.026-134.752c-58.485-58.485-58.485-153.647 0-212.133 28.331-28.331 66-43.935 106.066-43.935s77.734 15.604 106.065 43.935c58.485 58.485 58.485 153.647 0 212.133-28.331 28.332-65.999 43.935-106.065 43.935-40.067 0-77.735-15.603-106.066-43.935z" /></svg>
            <input type='text' placeholder='Rechercher' />
          </div>
          <div className='nav-links'>
            <svg className='nav-icons' viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" onClick={Go_To_HomePage}><path d="m438.988 202.123-174-154c-3.769-3.336-9.427-3.351-13.213-.038l-176 154c-2.17 1.899-3.415 4.642-3.415 7.526v250c0 5.522 4.477 10 10 10h112c5.523 0 10-4.478 10-10v-120c0-29.775 24.224-54 54-54 29.775 0 54 24.225 54 54v120c0 5.522 4.478 10 10 10h110c5.522 0 10-4.478 10-10v-250c0-2.864-1.227-5.59-3.372-7.488zm-16.628 247.487h-90v-110c0-40.804-33.196-74-74-74s-74 33.196-74 74v110h-92v-235.462l165.962-145.216 164.038 145.182z" /></svg>
            <svg className='nav-icons' viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><path d="m448.279 66.692c-2.709-2.708-6.725-3.631-10.343-2.378l-367.695 127.279c-3.741 1.295-6.366 4.675-6.694 8.62-.329 3.945 1.701 7.713 5.177 9.608l152.981 83.444 83.444 152.98c1.763 3.23 5.141 5.212 8.776 5.212.276 0 .554-.012.832-.034 3.945-.329 7.326-2.954 8.621-6.694l127.28-367.695c1.252-3.618.328-7.634-2.379-10.342zm-44.885 30.743-176.099 176.098-129.139-70.439zm-91.517 319.378-70.439-129.138 176.099-176.1z" /></svg>
            <svg className='nav-icons' onClick={HandleCreatePostModal} viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><path d="m367.36 247.61h-100v-100c0-5.523-4.478-10-10-10-5.523 0-10 4.477-10 10v100h-100c-5.523 0-10 4.477-10 10 0 5.522 4.477 10 10 10h100v100c0 5.522 4.477 10 10 10 5.522 0 10-4.478 10-10v-100h100c5.522 0 10-4.478 10-10 0-5.523-4.477-10-10-10z" /><path d="m374.36 57.61h-234c-43.078 0-78 34.922-78 78v244c0 43.078 34.922 78 78 78h234c43.078 0 78-34.922 78-78v-244c0-43.078-34.922-78-78-78zm58 322c0 32.032-25.968 58-58 58h-234c-32.033 0-58-25.968-58-58v-244c0-32.033 25.967-58 58-58h234c32.032 0 58 25.967 58 58z" /></svg>
            <svg className='nav-icons' viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><path d="m358.162 143.041c-135.979 84.182-132.43 81.434-134.262 84.349l-81.109 131.023c-2.442 3.945-1.85 9.054 1.432 12.335 3.26 3.259 8.362 3.89 12.335 1.432 139.851-86.577 131.499-81.223 132.829-82.542 1.553-1.565-3.48 5.968 82.543-132.83 2.441-3.946 1.85-9.053-1.432-12.335-3.283-3.283-8.391-3.874-12.336-1.432zm-175.995 189.762 52.094-84.15 32.058 32.058zm98.294-66.236-32.058-32.058 84.15-52.094z" /><path d="m405.854 109.117c-82.07-82.068-214.91-82.076-296.986 0-81.878 81.879-81.878 215.106 0 296.986 82.067 82.067 214.906 82.079 296.986 0 81.876-81.88 81.876-215.107 0-296.986zm-14.143 282.843c-74.252 74.252-194.439 74.263-268.701 0-74.081-74.081-74.081-194.62 0-268.701 74.251-74.251 194.438-74.261 268.701 0 74.08 74.081 74.08 194.62 0 268.701z" /></svg>
            <svg className='nav-icons' viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><path d="m366.763 52.242c-55.361 0-84.61 26.631-109.467 70.722-24.856-44.091-54.105-70.722-109.466-70.722-65.874 0-119.466 53.593-119.466 119.467 0 40.249 13.648 76.775 42.952 114.948 25.864 33.693 62.063 66.07 100.388 100.348 25.502 22.809 51.872 46.395 78.522 73.045 1.953 1.952 4.512 2.929 7.071 2.929 2.56 0 5.118-.977 7.071-2.929 26.688-26.689 53.104-50.305 78.65-73.143 38.32-34.258 74.515-66.616 100.381-100.295 29.308-38.16 42.958-74.672 42.958-114.903-.001-65.874-53.65-119.467-119.594-119.467zm-37.075 319.755c-23.507 21.015-47.744 42.683-72.393 66.901-24.606-24.18-48.797-45.816-72.26-66.801-76.358-68.296-136.672-122.241-136.672-200.388 0-54.847 44.62-99.467 99.466-99.467 46.532 0 71.897 19.322 100.522 76.572 1.694 3.388 5.157 5.528 8.944 5.528 3.788 0 7.25-2.141 8.944-5.528 28.626-57.25 53.991-76.572 100.522-76.572 54.916 0 99.594 44.62 99.594 99.467.001 78.106-60.31 132.024-136.667 200.288z" /></svg>
            <div className='nav-icons nav-profile-icon' onClick={HandleDropdown}>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><g><g><path d="M256,288.389c-153.837,0-238.56,72.776-238.56,204.925c0,10.321,8.365,18.686,18.686,18.686h439.747c10.321,0,18.686-8.365,18.686-18.686C494.56,361.172,409.837,288.389,256,288.389z M55.492,474.628c7.35-98.806,74.713-148.866,200.508-148.866s193.159,50.06,200.515,148.866H55.492z" /></g></g><g><g><path d="M256,0c-70.665,0-123.951,54.358-123.951,126.437c0,74.19,55.604,134.54,123.951,134.54s123.951-60.35,123.951-134.534C379.951,54.358,326.665,0,256,0z M256,223.611c-47.743,0-86.579-43.589-86.579-97.168c0-51.611,36.413-89.071,86.579-89.071c49.363,0,86.579,38.288,86.579,89.071C342.579,180.022,303.743,223.611,256,223.611z" /></g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g></svg>
            </div>
            {
              isDropdownOpen
                ?
                <div className='nav-dropdown'>
                  <div className='nav-dropdown-link' onClick={Go_To_Profile}>
                    <svg id='profile' viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><path d="m257.36 241.61c43.01 0 78-34.99 78-78 0-43.009-34.99-78-78-78s-78 34.991-78 78c0 43.01 34.991 78 78 78zm0-136c31.981 0 58 26.019 58 58s-26.019 58-58 58c-31.982 0-58-26.019-58-58s26.018-58 58-58z" /><path d="m349.538 255.61h-184.356c-39.052 0-70.822 31.771-70.822 70.822v93.178c0 5.522 4.477 10 10 10s10-4.478 10-10v-93.178c0-28.023 22.799-50.822 50.822-50.822h184.356c28.023 0 50.822 22.799 50.822 50.822v93.178c0 5.522 4.478 10 10 10s10-4.478 10-10v-93.178c0-39.05-31.77-70.822-70.822-70.822z" /></svg>
                    <span>Profil</span>
                  </div>
                  <div className='nav-dropdown-link'>
                    <svg id='bookmark' viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><path d="m427.36 27.61h-340c-5.523 0-10 4.478-10 10v440c0 4.012 2.398 7.636 6.09 9.204 3.692 1.567 7.965.779 10.853-2.007l163.057-157.302 163.057 157.303c1.902 1.834 4.403 2.803 6.945 2.803 1.318 0 2.646-.261 3.907-.796 3.693-1.568 6.091-5.192 6.091-9.204v-440c0-5.523-4.477-10.001-10-10.001zm-10 426.458-153.057-147.655c-1.937-1.868-4.439-2.803-6.942-2.803s-5.006.935-6.943 2.803l-153.058 147.655v-406.458h320z" /></svg>
                    <span>Enregistré</span>
                  </div>
                  <div className='nav-dropdown-link'>
                    <svg viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><path d="m452.738 196.61h-24.747c-1.889-5-4.215-10.95-7.021-16.815l17.598-17.574c1.878-1.878 2.938-4.427 2.936-7.083-.003-2.657-1.051-5.203-2.934-7.077l-72.005-71.669c-3.908-3.889-10.177-3.881-14.075.018l-17.225 17.325c-5.578-2.555-11.904-4.885-16.904-6.97v-24.532c0-5.523-4.877-9.623-10.399-9.623h-101.563c-5.523 0-10.04 4.1-10.04 9.623v24.532c-6 2.105-11.476 4.423-16.841 6.934l-17.606-17.347c-3.915-3.853-10.202-3.829-14.085.055l-71.668 71.667c-3.883 3.883-3.908 10.167-.056 14.081l17.346 17.615c-2.511 5.364-4.829 10.841-6.934 16.841h-24.533c-5.523 0-9.622 4.517-9.622 10.04v101.562c0 5.522 4.099 10.398 9.622 10.398h24.533c2.085 5 4.415 11.32 6.97 16.896l-17.325 17.117c-3.898 3.898-3.906 10.201-.018 14.109l71.668 71.996c1.874 1.883 4.42 2.881 7.076 2.881h.013c2.652 0 5.186-.988 7.062-2.863l17.584-17.529c5.865 2.807 11.815 5.136 16.815 7.024v24.747c0 5.522 4.517 9.621 10.04 9.621h101.562c5.522 0 10.399-4.099 10.399-9.621v-24.741c5-1.856 10.68-4.19 16.879-7.099l17.094 17.541c1.87 1.899 4.422 2.92 7.088 2.92h.04c2.651 0 5.195-.976 7.071-2.851l72.029-71.952c1.885-1.885 2.939-4.42 2.929-7.086s-1.086-5.167-2.985-7.037l-17.574-17.196c2.908-6.198 5.21-11.878 7.066-16.878h24.741c5.522 0 9.622-4.876 9.622-10.398v-101.562c-.001-5.523-4.1-10.04-9.623-10.04zm-10.378 102h-21.675c-4.465 0-8.387 2.761-9.613 7.054-2.313 8.096-5.771 16.36-11.213 27.246-1.938 3.876-1.156 8.56 1.933 11.599l15.512 15.26-57.761 57.773-15.233-15.505c-3.04-3.088-7.674-3.868-11.55-1.93-10.885 5.442-19.249 8.9-27.347 11.214-4.293 1.227-7.053 5.15-7.053 9.615v21.674h-82v-21.674c0-4.465-2.94-8.387-7.233-9.613-8.239-2.354-17.033-5.997-26.925-11.141-3.871-2.013-8.6-1.281-11.685 1.804l-15.6 15.607-57.562-57.839 15.276-15.252c3.043-3.044 3.798-7.645 1.873-11.494-4.433-8.865-8.238-18.104-11.309-27.658-1.329-4.135-5.176-6.74-9.52-6.74h-21.315v-82h21.314c4.344 0 8.191-2.784 9.52-6.92 3.156-9.817 6.937-18.969 11.237-27.238 2-3.845 1.295-8.54-1.745-11.628l-15.372-15.618 57.638-57.639 15.616 15.371c3.088 3.04 7.78 3.744 11.623 1.745 8.273-4.302 17.434-8.083 27.249-11.237 4.136-1.33 6.92-5.177 6.92-9.521v-21.315h82v21.315c0 4.344 2.605 8.191 6.74 9.521 9.553 3.07 18.691 6.874 27.56 11.308 3.85 1.925 8.5 1.171 11.543-1.873l15.275-15.277 57.852 57.561-15.601 15.597c-3.085 3.085-3.813 7.809-1.801 11.68 5.144 9.892 8.788 18.696 11.142 26.935 1.227 4.293 5.15 7.233 9.615 7.233h21.675z" /><path d="m257.204 119.772c-75.919 0-137.683 61.764-137.683 137.683 0 76.091 61.764 137.995 137.683 137.995 76.091 0 137.995-61.904 137.995-137.995 0-75.919-61.904-137.683-137.995-137.683zm0 255.678c-64.891 0-117.683-52.933-117.683-117.995 0-64.891 52.792-117.683 117.683-117.683 65.063 0 117.995 52.792 117.995 117.683 0 65.063-52.932 117.995-117.995 117.995z" /></svg>
                    <span>Paramètres</span>
                  </div>
                  <div className='nav-dropdown-link nav-dropdown-link-logout' onClick={Logout}>
                    <span>Déconnexion</span>
                  </div>
                </div>
                :
                undefined
            }
          </div>
        </div>
      </div>
    </nav>
  )
}

export default Nav